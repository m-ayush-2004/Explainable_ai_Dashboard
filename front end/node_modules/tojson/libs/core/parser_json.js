// Generated by CoffeeScript 1.8.0
(function() {
  var getItem, getType;

  getType = require('./convertType.js').getType;

  getItem = require('./convertType.js').getItem;

  module.exports = function(params) {
    var arrReg, fieldStr, headArr, headStr, index, key, match, pointer, type;
    type = getType(this.getHead());
    fieldStr = this.getHead().replace(this.regExp, "");
    headArr = fieldStr.split(".");
    pointer = params.resultRow;
    arrReg = /\[([0-9]*)\]/;
    while (headArr.length > 1) {
      headStr = headArr.shift();
      match = headStr.match(arrReg);
      if (match) {
        if (pointer[headStr.replace(match[0], "")] == null) {
          pointer[headStr.replace(match[0], "")] = [];
        }
        index = match[1];
        pointer = pointer[headStr.replace(match[0], "")];
        if (index === "") {
          index = pointer.length;
        }
        if (!pointer[index]) {
          pointer[index] = {};
        }
        pointer = pointer[index];
      } else {
        if (pointer[headStr] == null) {
          pointer[headStr] = {};
        }
        pointer = pointer[headStr];
      }
    }
    key = headArr.shift();
    match = key.match(arrReg);
    if (match) {
      index = match[1];
      key = key.replace(match[0], "");
      if (!pointer[key] || !pointer[key] instanceof Array) {
        pointer[key] = [];
      }
      if (index === "") {
        index = pointer[key].length;
      }
      pointer[key][index] = getItem(type, params.item);
    } else {
      pointer[key] = getItem(type, params.item);
    }
  };

}).call(this);
